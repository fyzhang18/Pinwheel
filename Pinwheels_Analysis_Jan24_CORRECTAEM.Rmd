---
title: "Jan 24"
author: "Felicia Zhang"
date: '2018-01-24'
output: html_document
---
RESTARTED FROM THE BEGINNING
THIS HAS CORRECT AEM CODING
```{r setup, include=FALSE}
library(ggplot2) 
library(zoo)
library(reshape)
library(plyr)
library(dplyr)
library(scales) 
library(data.table)
library(signal)
library(matrixStats)
library(lme4)
library(arm)
library(RColorBrewer)
library(lmerTest)
library(boot)

#load preprocessed data
<<<<<<< HEAD
=======
<<<<<<< HEAD
<<<<<<< HEAD
=======
#Oct21 has PUPIL_CORRECTED_2 calculated using 0-1500ms
>>>>>>> e07315faf246ed4d60125eedc34ea193d6ecb04d
>>>>>>> 619613d5808cccb9dddffadafe69798ac9e89045
=======
#Oct21 has PUPIL_CORRECTED_2 calculated using 0-1500ms
>>>>>>> e07315faf246ed4d60125eedc34ea193d6ecb04d
>>>>>>> 619613d5808cccb9dddffadafe69798ac9e89045
orig.sample <- read.csv("/Volumes/emberson/ResearchProjects/Pupillometry/Pinwheels/Data/Pinwheel_Infant_Preprocessed_AllSamples_Nov28.csv") #Nov28 has trackloss % for all trials
orig.sample2 <- read.csv("/Volumes/emberson/ResearchProjects/Pupillometry/Pinwheels/Data/Pinwheel_Infant_Preprocessed_RemovedOutliers_Nov28.csv")  #Nov28 has bad trials removed
orig.sample$X <- NULL
orig.sample2$X <- NULL
orig.sample$X.1 <- NULL
orig.sample2$X.1 <- NULL

#REMOVE TRIALS 5-8 FOR EACH SUBBLOCK
orig.sample$trialnum <- 0
orig.sample$trialnum[orig.sample$TRIAL_INDEX == 1 | orig.sample$TRIAL_INDEX == 9 | orig.sample$TRIAL_INDEX == 17 | orig.sample$TRIAL_INDEX == 25 | orig.sample$TRIAL_INDEX == 33 | orig.sample$TRIAL_INDEX == 41] <- 1
orig.sample$trialnum[orig.sample$TRIAL_INDEX == 2 | orig.sample$TRIAL_INDEX == 10 | orig.sample$TRIAL_INDEX == 18 | orig.sample$TRIAL_INDEX == 26 | orig.sample$TRIAL_INDEX == 34 | orig.sample$TRIAL_INDEX == 42] <- 2
orig.sample$trialnum[orig.sample$TRIAL_INDEX == 3 | orig.sample$TRIAL_INDEX == 11 | orig.sample$TRIAL_INDEX == 19 | orig.sample$TRIAL_INDEX == 27 | orig.sample$TRIAL_INDEX == 35 | orig.sample$TRIAL_INDEX == 43] <- 3
orig.sample$trialnum[orig.sample$TRIAL_INDEX == 4 | orig.sample$TRIAL_INDEX == 12 | orig.sample$TRIAL_INDEX == 20 | orig.sample$TRIAL_INDEX == 28 | orig.sample$TRIAL_INDEX == 36 | orig.sample$TRIAL_INDEX == 44] <- 4
orig.sample$trialnum[orig.sample$TRIAL_INDEX == 5 | orig.sample$TRIAL_INDEX == 13 | orig.sample$TRIAL_INDEX == 21 | orig.sample$TRIAL_INDEX == 29 | orig.sample$TRIAL_INDEX == 37 | orig.sample$TRIAL_INDEX == 45] <- 5
orig.sample$trialnum[orig.sample$TRIAL_INDEX == 6 | orig.sample$TRIAL_INDEX == 14 | orig.sample$TRIAL_INDEX == 22 | orig.sample$TRIAL_INDEX == 30 | orig.sample$TRIAL_INDEX == 38 | orig.sample$TRIAL_INDEX == 46] <- 6
orig.sample$trialnum[orig.sample$TRIAL_INDEX == 7 | orig.sample$TRIAL_INDEX == 15 | orig.sample$TRIAL_INDEX == 23 | orig.sample$TRIAL_INDEX == 31 | orig.sample$TRIAL_INDEX == 39 | orig.sample$TRIAL_INDEX == 47] <- 7
orig.sample$trialnum[orig.sample$TRIAL_INDEX == 8 | orig.sample$TRIAL_INDEX == 16 | orig.sample$TRIAL_INDEX == 24 | orig.sample$TRIAL_INDEX == 32 | orig.sample$TRIAL_INDEX == 40 | orig.sample$TRIAL_INDEX == 48] <- 8

orig.sample2$trialnum <- 0
orig.sample2$trialnum[orig.sample2$TRIAL_INDEX == 1 | orig.sample2$TRIAL_INDEX == 9 | orig.sample2$TRIAL_INDEX == 17 | orig.sample2$TRIAL_INDEX == 25 | orig.sample2$TRIAL_INDEX == 33 | orig.sample2$TRIAL_INDEX == 41] <- 1
orig.sample2$trialnum[orig.sample2$TRIAL_INDEX == 2 | orig.sample2$TRIAL_INDEX == 10 | orig.sample2$TRIAL_INDEX == 18 | orig.sample2$TRIAL_INDEX == 26 | orig.sample2$TRIAL_INDEX == 34 | orig.sample2$TRIAL_INDEX == 42] <- 2
orig.sample2$trialnum[orig.sample2$TRIAL_INDEX == 3 | orig.sample2$TRIAL_INDEX == 11 | orig.sample2$TRIAL_INDEX == 19 | orig.sample2$TRIAL_INDEX == 27 | orig.sample2$TRIAL_INDEX == 35 | orig.sample2$TRIAL_INDEX == 43] <- 3
orig.sample2$trialnum[orig.sample2$TRIAL_INDEX == 4 | orig.sample2$TRIAL_INDEX == 12 | orig.sample2$TRIAL_INDEX == 20 | orig.sample2$TRIAL_INDEX == 28 | orig.sample2$TRIAL_INDEX == 36 | orig.sample2$TRIAL_INDEX == 44] <- 4
orig.sample2$trialnum[orig.sample2$TRIAL_INDEX == 5 | orig.sample2$TRIAL_INDEX == 13 | orig.sample2$TRIAL_INDEX == 21 | orig.sample2$TRIAL_INDEX == 29 | orig.sample2$TRIAL_INDEX == 37 | orig.sample2$TRIAL_INDEX == 45] <- 5
orig.sample2$trialnum[orig.sample2$TRIAL_INDEX == 6 | orig.sample2$TRIAL_INDEX == 14 | orig.sample2$TRIAL_INDEX == 22 | orig.sample2$TRIAL_INDEX == 30 | orig.sample2$TRIAL_INDEX == 38 | orig.sample2$TRIAL_INDEX == 46] <- 6
orig.sample2$trialnum[orig.sample2$TRIAL_INDEX == 7 | orig.sample2$TRIAL_INDEX == 15 | orig.sample2$TRIAL_INDEX == 23 | orig.sample2$TRIAL_INDEX == 31 | orig.sample2$TRIAL_INDEX == 39 | orig.sample2$TRIAL_INDEX == 47] <- 7
orig.sample2$trialnum[orig.sample2$TRIAL_INDEX == 8 | orig.sample2$TRIAL_INDEX == 16 | orig.sample2$TRIAL_INDEX == 24 | orig.sample2$TRIAL_INDEX == 32 | orig.sample2$TRIAL_INDEX == 40 | orig.sample2$TRIAL_INDEX == 48] <- 8

#orig.sample = all trials
#orig.sample2 = trials with more than 50% looking
```

AEM coding
```{r}
poo <- orig.sample2

#1. Binning every 100ms, to make sure that it's actually a fixation for lookstotarget
moo <- data.frame(subID=numeric(),trialnum=numeric(),timecode=numeric(),lookingattarget=numeric())
subs <- unique(poo$subID)
time <- seq(100,4000, by=100) #the time bins we are trying to create (0-4000ms) doing 4000ms bc s

for (j in 1:length(subs)) {
  #gets every trial for 1 subject
  trials <- unique(poo$TRIAL_INDEX[poo$subID==subs[j]])
  print(j)
  for (i in 1:length(trials)) {
    #gets all sample for 1 trial  
    woo <- subset(poo, subID==subs[j] & TRIAL_INDEX == trials[i])
    c <- woo$block[1]
    for (k in 1:length(time)){
      #for every 25 sample/100 ms, get lookattarget column
      if (k==1) {
        target <- woo$lookattarget[woo$TIMECODE < time[k]+1] #gets 0-100ms
        d <- unique(target)
        dd <- which(d==1)
      } else {
        target <- woo$lookattarget[woo$TIMECODE < time[k]+1 & woo$TIMECODE > time[k-1]-1]
        d <- unique(target)
        dd <- which(d==1)
      }
      #see if entire chunk is looking at target
      if (length(target)==0) { #no samples collected during this time
        aa <- c(subs[j],trials[i],c,time[k],99)   
        moo <- rbind(moo,aa)
        warnings()
      } else if (length(d)==1 & d==1) { #looking at target entire time
        aa <- c(subs[j],trials[i],c,time[k],d)   
        moo <- rbind(moo,aa)
        warnings()
      } else if (length(d)==1 & d==0) { #looking at distractor entire time
        aa <- c(subs[j],trials[i],c,time[k],d)   
        moo <- rbind(moo,aa)
        warnings()
      } else if (length(d)==1 & d==5) { #looking at center entire time
        aa <- c(subs[j],trials[i],c,time[k],d)   
        moo <- rbind(moo,aa)
        warnings()
      } else if (length(d) > 1 & length(dd) < 1) { #not looking at same location and not looking at target (looking at distractor and center)
        aa <- c(subs[j],trials[i],c,time[k],9)   
        moo <- rbind(moo,aa) 
        warnings()
      } else { #not looking at same location and but looking at target sometimes
        #calculate proportion looking  
        b <- length(which(target==1)) #samples where subs are looking at target
        bb <- length(which(target==1))/length(target) #looking at target/25
        aa <- c(subs[j],trials[i],c,time[k],bb) 
        moo <- rbind(moo,aa)
        warnings()
      }}}}

names(moo)[1] <- "subID"
names(moo)[2] <- "trialnum"
names(moo)[3] <- "block"
names(moo)[4] <- "timecode"
names(moo)[5] <- "lookattarget"

moo$switch <- 1
moo$switch[moo$trialnum > 8 & moo$trialnum < 17 ] <- 2
moo$switch[moo$trialnum > 24 & moo$trialnum < 33 ] <- 2
moo$switch[moo$trialnum > 40 ] <- 2

#0 = distractor, 1 = target, 5 = center, 9 = looking at distractor and center, 99 = no data collected
x1 <- subset(moo, lookattarget < 99) #remove no data collected
x1$looktocenter <- 0

#coding which trials looked to center before making AEM
subs <- unique(x1$subID)
for (j in 1:length(subs)) {
  #gets every trial for 1 subject
  trials <- unique(x1$trialnum[x1$subID==subs[j]])
  print(j)
  for (i in 1:length(trials)) {
    foo <- subset(x1, subID==subs[j] & trialnum==trials[i] & timecode < 701)  
    if (any(foo$lookattarget==5)) {
      x1$looktocenter[x1$subID==subs[j] & x1$trialnum==trials[i]] <- 1
    }
  }}

#code trial type: correct AEM, incorrect AEM, or no AEM 
#must look to center first, must make eye movement in 700-2700ms
#type 1 = correct AEM to target, 2 = incorrect AEM to distractor, 3 = no AEM

x1$type <- 3
subs <- unique(x1$subID)
for (j in 1:length(subs)) {
  #gets every trial for 1 subject
  trials <- unique(x1$trialnum[x1$subID==subs[j]])
  print(j)
  for (i in 1:length(trials)) {
<<<<<<< HEAD
    foo <- subset(x1, subID==subs[j] & trialnum==trials[i] & timecode > 699 & timecode <2601) 
=======
<<<<<<< HEAD
<<<<<<< HEAD
    foo <- subset(x1, subID==subs[j] & trialnum==trials[i] & timecode > 699 & timecode <2601) 
=======
    foo <- subset(x1, subID==subs[j] & trialnum==trials[i] & timecode > 699 & timecode <2701) 
>>>>>>> e07315faf246ed4d60125eedc34ea193d6ecb04d
>>>>>>> 619613d5808cccb9dddffadafe69798ac9e89045
=======
    foo <- subset(x1, subID==subs[j] & trialnum==trials[i] & timecode > 699 & timecode <2701) 
>>>>>>> e07315faf246ed4d60125eedc34ea193d6ecb04d
>>>>>>> 619613d5808cccb9dddffadafe69798ac9e89045
    if (any(foo$lookattarget==0) & foo$looktocenter[1]==1) {
      x1$type[x1$subID==subs[j] & x1$trialnum==trials[i]] <- 2
    }
    if (any(foo$lookattarget==1) & foo$looktocenter[1]==1) {
      x1$type[x1$subID==subs[j] & x1$trialnum==trials[i]] <- 1
    }}}

x1$trialnum2 <- 0
x1$trialnum2[x1$trialnum == 1 | x1$trialnum == 9 | x1$trialnum == 17 | x1$trialnum == 25 | x1$trialnum == 33 | x1$trialnum == 41] <- 1
x1$trialnum2[x1$trialnum == 2 | x1$trialnum == 10 | x1$trialnum == 18 | x1$trialnum == 26 | x1$trialnum == 34 | x1$trialnum == 42] <- 2
x1$trialnum2[x1$trialnum == 3 | x1$trialnum == 11 | x1$trialnum == 19 | x1$trialnum == 27 | x1$trialnum == 35 | x1$trialnum == 43] <- 3
x1$trialnum2[x1$trialnum == 4 | x1$trialnum == 12 | x1$trialnum == 20 | x1$trialnum == 28 | x1$trialnum == 36 | x1$trialnum == 44] <- 4
x1$trialnum2[x1$trialnum == 5 | x1$trialnum == 13 | x1$trialnum == 21 | x1$trialnum == 29 | x1$trialnum == 37 | x1$trialnum == 45] <- 5
x1$trialnum2[x1$trialnum == 6 | x1$trialnum == 14 | x1$trialnum == 22 | x1$trialnum == 30 | x1$trialnum == 38 | x1$trialnum == 46] <- 6
x1$trialnum2[x1$trialnum == 7 | x1$trialnum == 15 | x1$trialnum == 23 | x1$trialnum == 31 | x1$trialnum == 39 | x1$trialnum == 47] <- 7
x1$trialnum2[x1$trialnum == 8 | x1$trialnum == 16 | x1$trialnum == 24 | x1$trialnum == 32 | x1$trialnum == 40 | x1$trialnum == 48] <- 8

aembreakdown <- x1
```

number of trials completed per subject
```{r}
v1 <- ddply(orig.sample2,.(subID),summarise,trials=length(unique(TRIAL_INDEX,na.rm = TRUE)))  
v1$group <- 1
names(v1)[2] <- "aem"

ggplot(v1,aes(x=factor(subID),y=aem))+
  theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),axis.line = element_line(colour = "black"))+
  geom_bar(stat="identity")+ggtitle("Number of trials included per subject")+
  labs(x = "Subject ID", y = "Number of trials")+
  theme(plot.title = element_text(face="bold", size=20, hjust=0))+
  theme(axis.title = element_text(face="bold", size=20))+ 
  theme(axis.text.x  = element_text(size=20),axis.text.y  = element_text(size=20))+
  theme(legend.text=element_text(size=16),legend.title=element_text(size=16))+
  theme(legend.position="none")+
  scale_y_continuous(limits=c(0,48),breaks=seq(0,48,4))
```

number of trials completed per subject, broken down by block and switch
```{r}
v1 <- ddply(orig.sample2,.(subID,block,switch),summarise,trials=length(unique(TRIAL_INDEX,na.rm = TRUE)))  
v2 <- ddply(v1,.(block,switch),summarise,trials=sum(trials,na.rm = TRUE))
dodge <- position_dodge(width=0.9)
split <- c(`1` = "block 1",`2` = "block 2",`3` = "block 3")

ggplot(v2,aes(x=factor(switch),y=trials,fill=factor(switch),color=factor(switch)))+
  geom_bar(stat="identity",position=dodge)+
  labs(y = "Number of trials")+
  theme(plot.title = element_text(face="bold", size=20, hjust=0))+
  theme(axis.title = element_text(face="bold", size=20),axis.title.x=element_blank())+ 
  theme(axis.text.x  = element_text(size=20),axis.text.y  = element_text(size=20))+
  theme(legend.text=element_text(size=16),legend.title=element_text(size=16))+
  guides(color=FALSE)+facet_wrap(~block,labeller = as_labeller(split))+
  theme(strip.text = element_text(size=16))+
  scale_x_discrete(breaks=c("1","2"),labels=c("pre-switch", "post-switch"))+
  scale_y_continuous(limits=c(0,200),breaks=seq(0,200,25))+guides(fill=FALSE)
```

looking percentage completed per subject
```{r}
v1 <- ddply(orig.sample2,.(subID,TRIAL_INDEX),summarise,percentnotlooking=mean(trackloss,na.rm = TRUE))  
v1$percentlooking <- 1-v1$percentnotlooking

v2 <- ddply(v1,.(subID),summarise,lookingavg=mean(percentlooking,na.rm = TRUE),selooking=sd(percentlooking, na.rm = TRUE)/sqrt(length(percentlooking)))
limits <- aes(ymax = lookingavg + selooking, ymin=lookingavg - selooking)

ggplot(v2,aes(x=factor(subID),y=lookingavg))+
  theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),axis.line = element_line(colour = "black"))+
  geom_bar(stat="identity")+ggtitle("Looking percentage per subject")+
  labs(x = "Subject ID", y = "% Looking")+
  theme(plot.title = element_text(face="bold", size=20, hjust=0))+
  theme(axis.title = element_text(face="bold", size=20))+ 
  theme(axis.text.x  = element_text(size=20),axis.text.y  = element_text(size=20))+
  theme(legend.text=element_text(size=16),legend.title=element_text(size=16))+
  theme(legend.position="none")+
  scale_y_continuous(labels=percent, limits=c(0,1),breaks=seq(0,1,.2))+
  geom_errorbar(limits, width=0.25,position = position_dodge(0.9),color="black")+
  geom_hline(yintercept=mean(v2$lookingavg),color="red")
```

AEM break down by number and percentage for each subject
```{r}
z1 <- ddply(orig.sample2,.(subID),summarise,trials=length(unique(TRIAL_INDEX,na.rm = TRUE)))  
z1$group <- 1
names(z1)[2] <- "numoftrials"

#breaking it down for correct and incorrect
#type 1 = correct AEM to target, 2 = incorrect AEM to distractor, 3 = no AEM
z2 <- ddply(aembreakdown,.(subID,type),summarise,numoftrials=length(unique(trialnum,na.rm = TRUE)))  
z2 <- subset(z2, type < 3) #only want correct and incorrect
z3 <- subset(z2, type==1)
z3$type <- NULL
z3$group <- 3

newData1 <- data.frame(subID = "2", numoftrials = "0", group = "3")
newData2 <- data.frame(subID = "8", numoftrials = "0", group = "3")
newData3 <- data.frame(subID = "17", numoftrials = "0", group = "3")
newData4 <- data.frame(subID = "19", numoftrials = "0", group = "3")
newData5 <- data.frame(subID = "21", numoftrials = "0", group = "3")
newData6 <- data.frame(subID = "22", numoftrials = "0", group = "3")
newData7 <- data.frame(subID = "27", numoftrials = "0", group = "3")

z3 <- rbind( z3[1,], newData1, z3[2:27,] )
z3 <- rbind( z3[1:7,], newData2, z3[8:28,] )
z3 <- rbind( z3[1:16,], newData3, z3[17:29,] )
z3 <- rbind( z3[1:18,], newData4, z3[19:30,] )
z3 <- rbind( z3[1:20,], newData5, z3[21:31,] )
z3 <- rbind( z3[1:21,], newData6, z3[22:32,] )
z3 <- rbind( z3[1:26,], newData7, z3[27:33,] )
z3$numoftrials <- as.numeric(as.character(z3$numoftrials))
z3$subID <- as.numeric(as.character(z3$subID))

z4 <- subset(z2, type==2)
z4$type <- NULL
z4$group <- 2

newData1 <- data.frame(subID = "3", numoftrials = "0", group = "2")
newData2 <- data.frame(subID = "8", numoftrials = "0", group = "2")
newData3 <- data.frame(subID = "11", numoftrials = "0", group = "2")
newData4 <- data.frame(subID = "14", numoftrials = "0", group = "2")
newData5 <- data.frame(subID = "18", numoftrials = "0", group = "2")
newData6 <- data.frame(subID = "19", numoftrials = "0", group = "2")
newData7 <- data.frame(subID = "21", numoftrials = "0", group = "2")
newData8 <- data.frame(subID = "22", numoftrials = "0", group = "2")
newData9 <- data.frame(subID = "25", numoftrials = "0", group = "2")
newData10 <- data.frame(subID = "30", numoftrials = "0", group = "2")
newData11 <- data.frame(subID = "34", numoftrials = "0", group = "2")

z4 <- rbind( z4[1:2,], newData1, z4[3:23,] )
z4 <- rbind( z4[1:7,], newData2, z4[8:24,] )
z4 <- rbind( z4[1:10,], newData3, z4[11:25,] )
z4 <- rbind( z4[1:13,], newData4, z4[14:26,] )
z4 <- rbind( z4[1:17,], newData5, z4[18:27,] )
z4 <- rbind( z4[1:18,], newData6, z4[19:28,] )
z4 <- rbind( z4[1:20,], newData7, z4[21:29,] )
z4 <- rbind( z4[1:21,], newData8, z4[22:30,] )
z4 <- rbind( z4[1:24,], newData9, z4[25:31,] )
z4 <- rbind( z4[1:29,], newData10, z4[30:32,] )
z4 <- rbind( z4[1:33,], newData11)
z4$numoftrials <- as.numeric(as.character(z4$numoftrials))
z4$subID <- as.numeric(as.character(z4$subID))

#group 1 = all trials, group 2 = incorrect, group 3= correct
z1$numoftrials <- z1$numoftrials - z4$numoftrials - z3$numoftrials

zfinal <- rbind(z1,z4,z3)
sort(zfinal$subID)
ggplot(zfinal,aes(x=factor(subID),y=numoftrials,color=factor(group),fill=factor(group)))+
  geom_bar(stat="identity")+
  labs(x = "Subject", y = "Number of trials")+
  theme(plot.title = element_text(face="bold", size=20, hjust=0))+
  theme(axis.title = element_text(face="bold", size=20))+ 
  theme(axis.text.x  = element_text(size=20),axis.text.y  = element_text(size=20))+
  theme(legend.text=element_text(size=16),legend.title=element_text(size=16))+
  guides(color=FALSE)+
  scale_fill_brewer(palette="Set3",name="Trial breakdown",breaks=c("1","2","3"),labels=c("no AEM", "incorrect AEMs","correct AEMs"))+
  scale_color_brewer(palette="Set3")+
  scale_y_continuous(limits=c(0,48),breaks=seq(0,48,4))

#percent
zfinal$percent <- 0

for (j in 1:length(subs)) {
 t <- sum(zfinal$numoftrials[zfinal$subID==subs[j]])
 zfinal$percent[zfinal$subID==subs[j]] <- zfinal$numoftrials[zfinal$subID==subs[j]] / t
}

ggplot(zfinal,aes(x=factor(subID),y=percent,color=factor(group),fill=factor(group)))+
  geom_bar(stat="identity")+
  labs(x = "Subject", y = "% of trials")+
  theme(plot.title = element_text(face="bold", size=20, hjust=0))+
  theme(axis.title = element_text(face="bold", size=20))+ 
  theme(axis.text.x  = element_text(size=20),axis.text.y  = element_text(size=20))+
  theme(legend.text=element_text(size=16),legend.title=element_text(size=16))+
  guides(color=FALSE)+
  scale_fill_brewer(palette="Set3",name="Trial breakdown",breaks=c("1","2","3"),labels=c("no AEM", "incorrect AEMs","correct AEMs"))+
  scale_color_brewer(palette="Set3")+
  scale_y_continuous(label=percent,limits=c(0,1),breaks=seq(0,1,.2))

```

count number of correct aems, preswitch and postswitch
```{r}
e1 <- subset(aembreakdown, type ==1)
e2 <- ddply(e1,.(subID,trialnum,trialnum2,switch),summarise,type=mean(type))  
e3 <- ddply(e2,.(subID,switch),summarise,numofaem = length(unique(trialnum,na.rm = TRUE)))

ggplot(e3,aes(x=factor(subID),y=numofaem,fill=factor(switch),color=factor(switch)))+
  geom_bar(stat="identity")+
  labs(x = "Subject", y = "Number of correct aems (/48)")+
  theme(plot.title = element_text(face="bold", size=20, hjust=0))+
  theme(axis.title = element_text(face="bold", size=20))+ 
  theme(axis.text.x  = element_text(size=20),axis.text.y  = element_text(size=20))+
  theme(legend.text=element_text(size=16),legend.title=element_text(size=16))+
  scale_y_continuous(limits=c(0,14),breaks=seq(0,14,2))

```

AEM breakdown by block and switch
```{r}
z1 <- ddply(orig.sample2,.(subID,block,switch),summarise,trials=length(unique(TRIAL_INDEX,na.rm = TRUE)))  
z2 <- ddply(z1,.(block,switch),summarise,trials=sum(trials,na.rm = TRUE))
z2$group <- 1
names(z2)[3] <- "trials"

#breaking it down for correct and incorrect
#type 1 = correct AEM to target, 2 = incorrect AEM to distractor, 3 = no AEM
z3 <- ddply(aembreakdown,.(subID,block,switch,type),summarise,numoftrials=length(unique(trialnum,na.rm = TRUE)))  
z3 <- subset(z3, type < 3) #only want correct and incorrect
z4 <- subset(z3, type==1)
z4$type <- NULL
z4$group <- 3

z5 <- subset(z3, type==2)
z5$type <- NULL
z5$group <- 2

z4 <- read.csv("/Volumes/emberson/ResearchProjects/Pupillometry/Pinwheels/Data/aem_group3_jan24.csv") 
z5 <- read.csv("/Volumes/emberson/ResearchProjects/Pupillometry/Pinwheels/Data/aem_group2_jan24.csv") 

z6 <- ddply(z4,.(block,switch),summarise,trials=sum(numoftrials,na.rm = TRUE)) #correct
z6$group <- 3
z7 <- ddply(z5,.(block,switch),summarise,trials=sum(numoftrials,na.rm = TRUE)) #incorrect
z7$group <- 2

#group 1 = all trials, group 2 = incorrect, group 3= correct
z2$trials <- z2$trials - z6$trials - z7$trials

zfinal <- rbind(z2,z6,z7)
split <- c(`1` = "block 1",`2` = "block 2",`3` = "block 3")

ggplot(zfinal,aes(x=factor(switch),y=trials,fill=factor(group),color=factor(group)))+
  geom_bar(stat="identity")+
  labs(y = "Number of trials")+
  theme(plot.title = element_text(face="bold", size=20, hjust=0))+
  theme(axis.title = element_text(face="bold", size=20),axis.title.x=element_blank())+ 
  theme(axis.text.x  = element_text(size=20),axis.text.y  = element_text(size=20))+
  theme(legend.text=element_text(size=16),legend.title=element_text(size=16))+
  guides(color=FALSE)+facet_wrap(~block,labeller = as_labeller(split))+
  theme(strip.text = element_text(size=16))+
  scale_x_discrete(breaks=c("1","2"),labels=c("pre-switch", "post-switch"))+
  scale_y_continuous(limits=c(0,200),breaks=seq(0,200,25))+
  scale_fill_discrete(name="Trial breakdown",breaks=c("1","2","3"),labels=c("no AEM", "incorrect AEMs","correct AEMs"))

#percent
zfinal$percent <- 0
zfinal$percent[zfinal$block==1 & zfinal$switch==1] <- zfinal$trials[zfinal$block==1 & zfinal$switch==1] / sum(zfinal$trials[zfinal$block==1 & zfinal$switch==1])
zfinal$percent[zfinal$block==1 & zfinal$switch==2] <- zfinal$trials[zfinal$block==1 & zfinal$switch==2] / sum(zfinal$trials[zfinal$block==1 & zfinal$switch==2])
zfinal$percent[zfinal$block==2 & zfinal$switch==1] <- zfinal$trials[zfinal$block==2 & zfinal$switch==1] / sum(zfinal$trials[zfinal$block==2 & zfinal$switch==1])
zfinal$percent[zfinal$block==2 & zfinal$switch==2] <- zfinal$trials[zfinal$block==2 & zfinal$switch==2] / sum(zfinal$trials[zfinal$block==2 & zfinal$switch==2])
zfinal$percent[zfinal$block==3 & zfinal$switch==1] <- zfinal$trials[zfinal$block==3 & zfinal$switch==1] / sum(zfinal$trials[zfinal$block==3 & zfinal$switch==1])
zfinal$percent[zfinal$block==3 & zfinal$switch==2] <- zfinal$trials[zfinal$block==3 & zfinal$switch==2] / sum(zfinal$trials[zfinal$block==3 & zfinal$switch==2])
  
ggplot(zfinal,aes(x=factor(switch),y=percent,fill=factor(group),color=factor(group)))+
  geom_bar(stat="identity")+
  labs(y = "Percent of trials")+
  theme(plot.title = element_text(face="bold", size=20, hjust=0))+
  theme(axis.title = element_text(face="bold", size=20),axis.title.x=element_blank())+ 
  theme(axis.text.x  = element_text(size=20),axis.text.y  = element_text(size=20))+
  theme(legend.text=element_text(size=16),legend.title=element_text(size=16))+
  guides(color=FALSE)+facet_wrap(~block,labeller = as_labeller(split))+
  theme(strip.text = element_text(size=16))+
  scale_x_discrete(breaks=c("1","2"),labels=c("pre-switch", "post-switch"))+
  scale_y_continuous(labels=percent,limits=c(0,1),breaks=seq(0,1,.2))+
  scale_fill_discrete(name="Trial breakdown",breaks=c("1","2","3"),labels=c("no AEM", "incorrect AEMs","correct AEMs"))
```

look at number of babies making CORRECT AEM for trials 1-8 for pre vs post
break it up by block
```{r}
c1 <- subset(aembreakdown, type ==1)

#break it up by block
#count how many babies made correct AEM, for every trial of each block and separating for pre and post
c2 <- ddply(c1,.(block,trialnum2,switch),summarise,numbabies=length(unique(subID,na.rm = TRUE)))
dodge <- position_dodge(width=0.9)

newData1 <- data.frame(block = "1", trialnum2 = "5", switch = "1", numbabies = "0")
newData2 <- data.frame(block = "1", trialnum2 = "6", switch = "1", numbabies = "0")
newData3 <- data.frame(block = "2", trialnum2 = "2", switch = "2", numbabies = "0")
newData4 <- data.frame(block = "3", trialnum2 = "2", switch = "2", numbabies = "0")
newData5 <- data.frame(block = "3", trialnum2 = "3", switch = "1", numbabies = "0")
newData6 <- data.frame(block = "3", trialnum2 = "3", switch = "2", numbabies = "0")
newData7 <- data.frame(block = "3", trialnum2 = "7", switch = "2", numbabies = "0")

c2 <- rbind( c2[1:8,], newData1, c2[9:41,] )
c2 <- rbind( c2[1:10,], newData2, c2[11:42,] )
c2 <- rbind( c2[1:19,], newData3, c2[20:43,] )
c2 <- rbind( c2[1:35,], newData4, c2[36:44,] )
c2 <- rbind( c2[1:36,], newData5, c2[37:45,] )
c2 <- rbind( c2[1:37,], newData6, c2[38:46,] )
c2 <- rbind( c2[1:45,], newData7, c2[46:47,] )

split <- c(`1` = "block 1",`2` = "block 2",`3` = "block 3")

c2$numbabies <- as.numeric(as.character(c2$numbabies))
ggplot(c2,aes(x=factor(trialnum2),y=numbabies,fill=factor(switch),color=factor(switch)))+
  geom_bar(stat="identity",position=dodge)+
  ggtitle("Correct AEM during 700 to 2700ms")+
  labs(x = "Trial number", y = "number of babies making AEM")+
  theme(plot.title = element_text(face="bold", size=20, hjust=0))+
  theme(axis.title = element_text(face="bold", size=20))+ 
  theme(axis.text.x  = element_text(size=20),axis.text.y  = element_text(size=20))+
  theme(legend.text=element_text(size=16),legend.title=element_text(size=16))+
  scale_fill_discrete(name="Switch",breaks=c("1", "2"),labels=c("preswitch", "postswitch"))+
  guides(color=FALSE)+facet_wrap(~block,labeller = as_labeller(split))+
  scale_y_continuous(limits=c(0,10),breaks=seq(0,10,2))+
  theme(strip.text = element_text(size=16))

#group together
#count how many babies made correct AEM, for each pre and post, but grouping blocks together
c3 <- ddply(c2,.(trialnum2,switch),summarise,meannum=mean(numbabies),
            sdnum = sd(numbabies, na.rm = TRUE)/sqrt(length(numbabies)))
<<<<<<< HEAD
dodge <- position_dodge(width=0.9)
=======
<<<<<<< HEAD
<<<<<<< HEAD
dodge <- position_dodge(width=0.9)
=======
>>>>>>> e07315faf246ed4d60125eedc34ea193d6ecb04d
>>>>>>> 619613d5808cccb9dddffadafe69798ac9e89045
=======
>>>>>>> e07315faf246ed4d60125eedc34ea193d6ecb04d
>>>>>>> 619613d5808cccb9dddffadafe69798ac9e89045
limits <- aes(ymax = meannum + sdnum, ymin=meannum - sdnum)

ggplot(c3,aes(x=factor(trialnum2),y=meannum,fill=factor(switch),color=factor(switch)))+
  geom_bar(stat="identity",position=dodge)+
  ggtitle("Correct AEM during 700 to 2700ms")+
  labs(x = "Trial number", y = "Number of babies making AEM")+
  theme(plot.title = element_text(face="bold", size=20, hjust=0))+
  theme(axis.title = element_text(face="bold", size=20))+ 
  theme(axis.text.x  = element_text(size=20),axis.text.y  = element_text(size=20))+
  theme(legend.text=element_text(size=16),legend.title=element_text(size=16))+
  scale_fill_discrete(name="Switch",breaks=c("1", "2"),labels=c("preswitch", "postswitch"))+
  guides(color=FALSE)+
  scale_y_continuous(limits=c(0,5),breaks=seq(0,5,1))+
  geom_errorbar(limits, width=0.25,position = position_dodge(0.9),color="black")
```

look at % of babies making CORRECT AEM for that trial
n babies made correct aems/total n of babies we have for that trial
```{r}
#break it up by block
#count how many babies made correct AEM, for every trial of each block and separating for pre and post
d1 <- ddply(aembreakdown,.(block,trialnum2,switch,type),summarise,numbabies=length(unique(subID,na.rm = TRUE)))
d2 <- subset(d1, type ==1) #babies that made correct AEM
d2$type <- NULL
newData1 <- data.frame(block = "1", trialnum2 = "5", switch = "1", numbabies = "0")
newData2 <- data.frame(block = "1", trialnum2 = "6", switch = "1", numbabies = "0")
newData3 <- data.frame(block = "2", trialnum2 = "2", switch = "2", numbabies = "0")
newData4 <- data.frame(block = "3", trialnum2 = "2", switch = "2", numbabies = "0")
newData5 <- data.frame(block = "3", trialnum2 = "3", switch = "1", numbabies = "0")
newData6 <- data.frame(block = "3", trialnum2 = "3", switch = "2", numbabies = "0")
newData7 <- data.frame(block = "3", trialnum2 = "7", switch = "2", numbabies = "0")

d2 <- rbind( d2[1:8,], newData1, d2[9:41,] )
d2 <- rbind( d2[1:10,], newData2, d2[11:42,] )
d2 <- rbind( d2[1:19,], newData3, d2[20:43,] )
d2 <- rbind( d2[1:35,], newData4, d2[36:44,] )
d2 <- rbind( d2[1:36,], newData5, d2[37:45,] )
d2 <- rbind( d2[1:37,], newData6, d2[38:46,] )
d2 <- rbind( d2[1:45,], newData7, d2[46:47,] )
d2$numbabies <- as.numeric(as.character(d2$numbabies))
d3 <- ddply(d1,.(block,trialnum2,switch),summarise,numbabies=sum(numbabies,na.rm = TRUE))

d2$percent <- d2$numbabies / d3$numbabies
dodge <- position_dodge(width=0.9)

split <- c(`1` = "block 1",`2` = "block 2",`3` = "block 3")

ggplot(d2,aes(x=factor(trialnum2),y=percent,fill=factor(switch),color=factor(switch)))+
  geom_bar(stat="identity",position=dodge)+
  ggtitle("Correct AEM during 700 to 2700ms")+
  labs(x = "Trial number", y = "% of babies making AEM")+
  theme(plot.title = element_text(face="bold", size=20, hjust=0))+
  theme(axis.title = element_text(face="bold", size=20))+ 
  theme(axis.text.x  = element_text(size=20),axis.text.y  = element_text(size=20))+
  theme(legend.text=element_text(size=16),legend.title=element_text(size=16))+
  scale_fill_discrete(name="Switch",breaks=c("1", "2"),labels=c("preswitch", "postswitch"))+
  guides(color=FALSE)+facet_wrap(~block,labeller = as_labeller(split))+
  scale_y_continuous(labels=percent,limits=c(0,.3),breaks=seq(0,.3,.05))+
  theme(strip.text = element_text(size=16))
  
#group together
#count how many babies made correct AEM, for each pre and post, but grouping blocks together
d3 <- ddply(d2,.(trialnum2,switch),summarise,meanpercent=mean(percent),
            sdpercent = sd(percent, na.rm = TRUE)/sqrt(length(percent)))
limits <- aes(ymax = meanpercent + sdpercent, ymin=meanpercent - sdpercent)

ggplot(d3,aes(x=factor(trialnum2),y=meanpercent,fill=factor(switch),color=factor(switch)))+
  geom_bar(stat="identity",position=dodge)+
  ggtitle("Correct AEM during 700 to 2700ms")+
  labs(x = "Trial number", y = "% of babies making AEM")+
  theme(plot.title = element_text(face="bold", size=20, hjust=0))+
  theme(axis.title = element_text(face="bold", size=20))+ 
  theme(axis.text.x  = element_text(size=20),axis.text.y  = element_text(size=20))+
  theme(legend.text=element_text(size=16),legend.title=element_text(size=16))+
  scale_fill_discrete(name="Switch",breaks=c("1", "2"),labels=c("preswitch", "postswitch"))+
  guides(color=FALSE)+
  scale_y_continuous(label=percent,limits=c(0,.3),breaks=seq(0,.3,.05))+
  geom_errorbar(limits, width=0.25,position = position_dodge(0.9),color="black")

```

TIMECOURSE proportion of babies
a. for each subject, each timecode, collapse across trials
b. collapse across subjects
```{r}
e1 <- subset(aembreakdown, lookattarget < 9) #only care about 100ms timebins that has good data

#type 1 = correct AEM to target, 2 = incorrect AEM to distractor, 3 = no AEM
#Calculate proplooking for each type of gaze (target, center, distractor)
e1$center <- 0
e1$distractor <- 0
e1$target <- 0  

e1$target[e1$lookattarget == 1] <- 1 #if lookattarget == 1, then looking at target
e1$center[e1$lookattarget == 5] <- 1 #if lookattarget == 5, then looking at center
e1$distractor[e1$lookattarget == 0] <- 1 #if lookattarget == 0, then looking at distractor

e2 <- ddply(e1,.(subID,timecode),summarise,TargProp=mean(target,na.rm = TRUE),CentProp=mean(center,na.rm = TRUE),DistProp=mean(distractor,na.rm = TRUE))

#collapse across subjects
e31 <- ddply(e2,.(timecode),summarise,
            looking=mean(TargProp,na.rm = TRUE),
            selooking=sd(TargProp, na.rm = TRUE)/sqrt(length(TargProp)))
e31$group <- 1
e32 <- ddply(e2,.(timecode),summarise,
            looking=mean(CentProp,na.rm = TRUE),
            selooking=sd(CentProp, na.rm = TRUE)/sqrt(length(CentProp)))
e32$group <- 2
e33 <- ddply(e2,.(timecode),summarise,
            looking=mean(DistProp,na.rm = TRUE),
            selooking=sd(DistProp, na.rm = TRUE)/sqrt(length(DistProp)))
e33$group <- 3

efinal <- rbind(e31,e32,e33)
#group 1 - target, 2 = center, 3 = distractor

ggplot(efinal,aes(x=timecode,y=looking,color=factor(group),fill=factor(group)))+
  geom_line()+theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"))+
  ggtitle("Where are babies looking?")+
  labs(x = "Time", y = "% of looking")+
  theme(plot.title = element_text(face="bold", size=20, hjust=0))+
  theme(axis.title = element_text(face="bold", size=20))+ 
  theme(axis.text.x  = element_text(size=14),axis.text.y  = element_text(size=14))+
  theme(legend.text=element_text(size=14),legend.title=element_text(size=14))+
  geom_ribbon(aes(ymin=looking-selooking,ymax=looking+selooking),alpha=0.4)+
  geom_vline(xintercept = vlines)+
  scale_x_continuous(limits=c(0,4000),breaks=seq(0,4000,500), expand = c(0, 0))+
  scale_y_continuous(labels=percent,limits=c(0,1),breaks=seq(0,1,0.2))+
  scale_fill_discrete(name="Looking",breaks=c("1","2","3"),labels=c("Target", "Center","Distractor"))+guides(color=FALSE)+
  theme(strip.text = element_text(size=14))

#by block
e2 <- ddply(e1,.(subID,block,timecode),summarise,TargProp=mean(target,na.rm = TRUE),CentProp=mean(center,na.rm = TRUE),DistProp=mean(distractor,na.rm = TRUE))

#collapse across subjects
e31 <- ddply(e2,.(block,timecode),summarise,
            looking=mean(TargProp,na.rm = TRUE),
            selooking=sd(TargProp, na.rm = TRUE)/sqrt(length(TargProp)))
e31$group <- 1
e32 <- ddply(e2,.(block,timecode),summarise,
            looking=mean(CentProp,na.rm = TRUE),
            selooking=sd(CentProp, na.rm = TRUE)/sqrt(length(CentProp)))
e32$group <- 2
e33 <- ddply(e2,.(block,timecode),summarise,
            looking=mean(DistProp,na.rm = TRUE),
            selooking=sd(DistProp, na.rm = TRUE)/sqrt(length(DistProp)))
e33$group <- 3

efinal <- rbind(e31,e32,e33)
#group 1 - target, 2 = center, 3 = distractor

split <- c(`1` = "Block 1",`2` = "Block 2",`3` = "Block 3")
ggplot(efinal,aes(x=timecode,y=looking,color=factor(group),fill=factor(group)))+
  geom_line()+theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"))+
  ggtitle("Where are babies looking?")+
  labs(x = "Time", y = "% of looking")+
  theme(plot.title = element_text(face="bold", size=20, hjust=0))+
  theme(axis.title = element_text(face="bold", size=20))+ 
  theme(axis.text.x  = element_text(size=14),axis.text.y  = element_text(size=14))+
  theme(legend.text=element_text(size=14),legend.title=element_text(size=14))+
  geom_ribbon(aes(ymin=looking-selooking,ymax=looking+selooking),alpha=0.4)+
  geom_vline(xintercept = vlines)+
  scale_x_continuous(limits=c(0,4000),breaks=seq(0,4000,500), expand = c(0, 0))+
  scale_y_continuous(labels=percent,limits=c(0,1),breaks=seq(0,1,0.2))+
  scale_fill_discrete(name="Looking",breaks=c("1","2","3"),labels=c("Target", "Center","Distractor"))+guides(color=FALSE)+
  facet_wrap(~block,labeller = as_labeller(split),dir="v")+
  theme(strip.text = element_text(size=14))

#by switch
e2 <- ddply(e1,.(subID,switch,timecode),summarise,TargProp=mean(target,na.rm = TRUE),CentProp=mean(center,na.rm = TRUE),DistProp=mean(distractor,na.rm = TRUE))

#collapse across subjects
e31 <- ddply(e2,.(switch,timecode),summarise,
            looking=mean(TargProp,na.rm = TRUE),
            selooking=sd(TargProp, na.rm = TRUE)/sqrt(length(TargProp)))
e31$group <- 1
e32 <- ddply(e2,.(switch,timecode),summarise,
            looking=mean(CentProp,na.rm = TRUE),
            selooking=sd(CentProp, na.rm = TRUE)/sqrt(length(CentProp)))
e32$group <- 2
e33 <- ddply(e2,.(switch,timecode),summarise,
            looking=mean(DistProp,na.rm = TRUE),
            selooking=sd(DistProp, na.rm = TRUE)/sqrt(length(DistProp)))
e33$group <- 3

efinal <- rbind(e31,e32,e33)
#group 1 - target, 2 = center, 3 = distractor

split <- c(`1` = "Target",`2` = "Center",`3` = "Distractor")
ggplot(efinal,aes(x=timecode,y=looking,color=factor(switch),fill=factor(switch)))+
  geom_line()+theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"))+
  ggtitle("Where are babies looking?")+
  labs(x = "Time", y = "% of looking")+
  theme(plot.title = element_text(face="bold", size=20, hjust=0))+
  theme(axis.title = element_text(face="bold", size=20))+ 
  theme(axis.text.x  = element_text(size=14),axis.text.y  = element_text(size=14))+
  theme(legend.text=element_text(size=14),legend.title=element_text(size=14))+
  geom_ribbon(aes(ymin=looking-selooking,ymax=looking+selooking),alpha=0.4)+
  geom_vline(xintercept = vlines)+
  scale_x_continuous(limits=c(0,4000),breaks=seq(0,4000,500), expand = c(0, 0))+
  scale_y_continuous(labels=percent,limits=c(0,1),breaks=seq(0,1,0.2))+
  scale_fill_discrete(name="Switch",breaks=c("1","2"),labels=c("Preswitch", "Postswitch"))+guides(color=FALSE)+
  facet_wrap(~group,labeller = as_labeller(split),dir="v")+
  theme(strip.text = element_text(size=14))

#by block V2
e2 <- ddply(e1,.(subID,block,timecode),summarise,TargProp=mean(target,na.rm = TRUE),CentProp=mean(center,na.rm = TRUE),DistProp=mean(distractor,na.rm = TRUE))

#collapse across subjects
e31 <- ddply(e2,.(block,timecode),summarise,
            looking=mean(TargProp,na.rm = TRUE),
            selooking=sd(TargProp, na.rm = TRUE)/sqrt(length(TargProp)))
e31$group <- 1
e32 <- ddply(e2,.(block,timecode),summarise,
            looking=mean(CentProp,na.rm = TRUE),
            selooking=sd(CentProp, na.rm = TRUE)/sqrt(length(CentProp)))
e32$group <- 2
e33 <- ddply(e2,.(block,timecode),summarise,
            looking=mean(DistProp,na.rm = TRUE),
            selooking=sd(DistProp, na.rm = TRUE)/sqrt(length(DistProp)))
e33$group <- 3

efinal <- rbind(e31,e32,e33)
#group 1 - target, 2 = center, 3 = distractor

split <- c(`1` = "Target",`2` = "Center",`3` = "Distractor")
ggplot(efinal,aes(x=timecode,y=looking,color=factor(block),fill=factor(block)))+
  geom_line()+theme_bw()+theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"))+
  ggtitle("Where are babies looking?")+
  labs(x = "Time", y = "% of looking")+
  theme(plot.title = element_text(face="bold", size=20, hjust=0))+
  theme(axis.title = element_text(face="bold", size=20))+ 
  theme(axis.text.x  = element_text(size=14),axis.text.y  = element_text(size=14))+
  theme(legend.text=element_text(size=14),legend.title=element_text(size=14))+
  geom_ribbon(aes(ymin=looking-selooking,ymax=looking+selooking),alpha=0.4)+
  geom_vline(xintercept = vlines)+
  scale_x_continuous(limits=c(0,4000),breaks=seq(0,4000,500), expand = c(0, 0))+
  scale_y_continuous(labels=percent,limits=c(0,1),breaks=seq(0,1,0.2))+
  scale_fill_discrete(name="Block")+guides(color=FALSE)+
  facet_wrap(~group,labeller = as_labeller(split),dir="v")+
  theme(strip.text = element_text(size=14))
```

look at number of babies making AEM to preswitch target location for pre vs post
break it up by block
```{r}
#type 1 = correct AEM to target, 2 = incorrect AEM to distractor, 3 = no AEM
h1 <- subset(aembreakdown, type ==1) #correct AEM
h2 <- subset(aembreakdown, type ==2) #incorrect to target

#collapse across trials
h11 <- ddply(h1,.(subID,trialnum,trialnum2,block,switch),summarise,type=mean(type,na.rm = TRUE))
h11 <- subset(h11,switch==1) #these are preswitch trials looking at preswitch location AKA Correct AEM

h22 <- ddply(h2,.(subID,trialnum,trialnum2,block,switch),summarise,type=mean(type,na.rm = TRUE))
h22 <- subset(h22,switch==2) #these are postswitch trials looking at preswitch location AKA incorrect AEM

#collapse across subs  

h3 <- ddply(h11,.(block,trialnum2,switch),summarise,numbabies=length(unique(subID,na.rm = TRUE)))
h4 <- ddply(h22,.(block,trialnum2,switch),summarise,numbabies=length(unique(subID,na.rm = TRUE)))
h5 <- rbind(h3,h4)

newData1 <- data.frame(block = "1", trialnum2 = "5", switch = "1", numbabies = "0")
newData2 <- data.frame(block = "1", trialnum2 = "6", switch = "1", numbabies = "0")
newData3 <- data.frame(block = "3", trialnum2 = "3", switch = "1", numbabies = "0")
newData4 <- data.frame(block = "1", trialnum2 = "1", switch = "2", numbabies = "0")
newData5 <- data.frame(block = "2", trialnum2 = "3", switch = "2", numbabies = "0")
newData6 <- data.frame(block = "3", trialnum2 = "8", switch = "2", numbabies = "0")

h5 <- rbind( h5[1:4,], newData1, h5[5:42,] )
h5 <- rbind( h5[1:5,], newData2, h5[6:43,] )
h5 <- rbind( h5[1:18,], newData3, h5[19:44,] )
h5 <- rbind( h5[1:24,], newData4, h5[25:45,] )
h5 <- rbind( h5[1:34,], newData5, h5[35:46,] )
h5 <- rbind( h5[1:47,], newData6)
h5$numbabies <- as.numeric(as.character(h5$numbabies))

dodge <- position_dodge(width=0.9)
ggplot(h5,aes(x=factor(trialnum2),y=numbabies,fill=factor(switch),color=factor(switch)))+
  geom_bar(stat="identity",position=dodge)+
  ggtitle("Looking at preswitch location during 700 to 2700ms")+
  labs(x = "Trial number", y = "number of babies")+
  theme(plot.title = element_text(face="bold", size=20, hjust=0))+
  theme(axis.title = element_text(face="bold", size=20))+ 
  theme(axis.text.x  = element_text(size=20),axis.text.y  = element_text(size=20))+
  theme(legend.text=element_text(size=16),legend.title=element_text(size=16))+
  scale_fill_discrete(name="Switch",breaks=c("1", "2"),labels=c("preswitch", "postswitch"))+
  guides(color=FALSE)+
  scale_y_continuous(limits=c(0,10),breaks=seq(0,10,2))+
  facet_wrap(~block)

#group together
#count how many babies made correct AEM, for each pre and post, but grouping blocks together
h6 <- ddply(h5,.(trialnum2,switch),summarise,meannum=mean(numbabies),
            sdnum = sd(numbabies, na.rm = TRUE)/sqrt(length(numbabies)))
limits <- aes(ymax = meannum + sdnum, ymin=meannum - sdnum)

ggplot(h6,aes(x=factor(trialnum2),y=meannum,fill=factor(switch),color=factor(switch)))+
  geom_bar(stat="identity",position=dodge)+
  ggtitle("Looking at preswitch location during 700 to 2700ms")+
  labs(x = "Trial number", y = "Number of babies making AEM")+
  theme(plot.title = element_text(face="bold", size=20, hjust=0))+
  theme(axis.title = element_text(face="bold", size=20))+ 
  theme(axis.text.x  = element_text(size=20),axis.text.y  = element_text(size=20))+
  theme(legend.text=element_text(size=16),legend.title=element_text(size=16))+
  scale_fill_discrete(name="Switch",breaks=c("1", "2"),labels=c("preswitch", "postswitch"))+
  guides(color=FALSE)+
  scale_y_continuous(limits=c(0,5),breaks=seq(0,5,1))+
  geom_errorbar(limits, width=0.25,position = position_dodge(0.9),color="black")
```

look at % of babies making AEM to preswitch target location for pre vs post
n babies made correct aems/total n of babies we have for that trial
```{r}
#break it up by block
#type 1 = correct AEM to target, 2 = incorrect AEM to distractor, 3 = no AEM
h1 <- subset(aembreakdown, type ==1) #correct AEM
h2 <- subset(aembreakdown, type ==2) #incorrect to target

#collapse across trials
h11 <- ddply(h1,.(subID,trialnum,trialnum2,block,switch),summarise,type=mean(type,na.rm = TRUE))
h11 <- subset(h11,switch==1) #these are preswitch trials looking at preswitch location AKA Correct AEM

h22 <- ddply(h2,.(subID,trialnum,trialnum2,block,switch),summarise,type=mean(type,na.rm = TRUE))
h22 <- subset(h22,switch==2) #these are postswitch trials looking at preswitch location AKA incorrect AEM

#data frames with number of babies that looked to preswitch location during preswitch trials (h3) 
#number of babies that looked to preswitch location during postswitch trials (h4)
h3 <- ddply(h11,.(block,trialnum2,switch),summarise,numbabies=length(unique(subID,na.rm = TRUE)))

newData1 <- data.frame(block = "1", trialnum2 = "5", switch = "1", numbabies = "0")
newData2 <- data.frame(block = "1", trialnum2 = "6", switch = "1", numbabies = "0")
newData3 <- data.frame(block = "3", trialnum2 = "3", switch = "1", numbabies = "0")
h3 <- rbind( h3[1:4,], newData1, h3[5:21,] )
h3 <- rbind( h3[1:5,], newData2, h3[6:22,] )
h3 <- rbind( h3[1:18,], newData3, h3[19:23,] )
h3$numbabies <- as.numeric(as.character(h3$numbabies))

h4 <- ddply(h22,.(block,trialnum2,switch),summarise,numbabies=length(unique(subID,na.rm = TRUE)))

newData1 <- data.frame(block = numeric(1), trialnum2 = numeric(1), switch = numeric(1), numbabies = numeric(1))
newData1$block <- 1
newData1$trialnum2 <- 1
newData1$switch <- 2
newData1$numbabies <- 0
h4 <- rbind(newData1,h4)

newData2 <- data.frame(block = "2", trialnum2 = "3", switch = "2", numbabies = "0")
newData3 <- data.frame(block = "3", trialnum2 = "8", switch = "2", numbabies = "0")

h4 <- rbind( h4[1:10,], newData2, h4[11:22,] )
h4 <- rbind( h4[1:23,], newData3)
h4$numbabies <- as.numeric(as.character(h4$numbabies))

#now get the total number of babies in each preswitch trial
j1 <- ddply(aembreakdown,.(block,trialnum2,switch),summarise,numbabies=length(unique(subID,na.rm = TRUE)))
j2 <- subset(j1, switch==1)
#now get the total number of babies in each postswitch trial
j3 <- subset(j1, switch==2)


h3$percent <- h3$numbabies / j2$numbabies #n babies made correct aems/total n of babies we have for that trial
h4$percent <- h4$numbabies / j3$numbabies
dodge <- position_dodge(width=0.9)
hfinal <- rbind(h3,h4)

split <- c(`1` = "block 1",`2` = "block 2",`3` = "block 3")
ggplot(hfinal,aes(x=factor(trialnum2),y=percent,fill=factor(switch),color=factor(switch)))+
  geom_bar(stat="identity",position=dodge)+
  ggtitle("Looking at preswitch location during 700 to 2700ms")+
  labs(x = "Trial number", y = "% of babies making AEM")+
  theme(plot.title = element_text(face="bold", size=20, hjust=0))+
  theme(axis.title = element_text(face="bold", size=20))+ 
  theme(axis.text.x  = element_text(size=20),axis.text.y  = element_text(size=20))+
  theme(legend.text=element_text(size=16),legend.title=element_text(size=16))+
  scale_fill_discrete(name="Switch",breaks=c("1", "2"),labels=c("preswitch", "postswitch"))+
  guides(color=FALSE)+facet_wrap(~block,labeller = as_labeller(split))+
  scale_y_continuous(labels=percent,limits=c(0,.3),breaks=seq(0,.3,.05))+
  theme(strip.text = element_text(size=16))
  
#group together
#count how many babies made correct AEM, for each pre and post, but grouping blocks together

h55 <- ddply(hfinal,.(trialnum2,switch),summarise,meanpercent=mean(percent),
            sdpercent = sd(percent, na.rm = TRUE)/sqrt(length(percent)))
limits <- aes(ymax = meanpercent + sdpercent, ymin=meanpercent - sdpercent)

ggplot(h55,aes(x=factor(trialnum2),y=meanpercent,fill=factor(switch),color=factor(switch)))+
  geom_bar(stat="identity",position=dodge)+
  ggtitle("Looking at preswitch location during 700 to 2700ms")+
  labs(x = "Trial number", y = "% of babies making AEM")+
  theme(plot.title = element_text(face="bold", size=20, hjust=0))+
  theme(axis.title = element_text(face="bold", size=20))+ 
  theme(axis.text.x  = element_text(size=20),axis.text.y  = element_text(size=20))+
  theme(legend.text=element_text(size=16),legend.title=element_text(size=16))+
  scale_fill_discrete(name="Switch",breaks=c("1", "2"),labels=c("preswitch", "postswitch"))+
  guides(color=FALSE)+
  scale_y_continuous(labels=percent,limits=c(0,.3),breaks=seq(0,.3,.05))+
  geom_errorbar(limits, width=0.25,position = position_dodge(0.9),color="black")
```


main pupil timecourse plot for orig.sample2
```{r}
# screen res is 1024 x 1280 (Y X)
#a. Y coordinate timecourse, pre and post
#line graph
boo1 <- ddply(orig.sample2,.(subID,switch,TIMECODE),summarise,pupil=mean(PUPIL_CORRECTED,na.rm = TRUE)) #collapse across trials
boo1 <- subset(boo1, TIMECODE < 4001)
boo2 <- ddply(boo1,.(switch,TIMECODE),summarise,pupilavg=mean(pupil,na.rm = TRUE),sepupil=sd(pupil, na.rm = TRUE)/sqrt(length(pupil))) #collapse across subs
vlines <- c(250,1750,2550)

ggplot(boo2,aes(x=TIMECODE,y=pupilavg,color=factor(switch),fill=factor(switch)))+
  geom_line()+theme_bw()+
  theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"))+
  ggtitle("Timecourse: Pupil Change")+
  labs(x = "Time", y = "Pupil change from baseline (%)")+
  theme(plot.title = element_text(face="bold", size=20, hjust=0))+
  theme(axis.title = element_text(face="bold", size=20))+ 
  theme(axis.text.x  = element_text(size=20),axis.text.y  = element_text(size=20))+
  theme(legend.text=element_text(size=16),legend.title=element_text(size=16))+
  geom_ribbon(aes(ymin=pupilavg-sepupil,ymax=pupilavg+sepupil),alpha=0.4)+
  geom_vline(xintercept = vlines)+
  scale_x_continuous(limits=c(0,4000),breaks=seq(0,4000,500), expand = c(0, 0))+
  scale_fill_discrete(name="Switch",breaks=c("1", "2"),labels=c("Pre-Switch", "Post-Switch"))+guides(color=FALSE)+
  scale_y_continuous(labels=percent,limits=c(-0.1,.1),breaks=seq(-0.1,.1,.02), expand = c(0, 0))

#facet_Wrap by block
#line graph
boo1 <- ddply(orig.sample2,.(subID,block,switch,TIMECODE),summarise,pupil=mean(PUPIL_CORRECTED,na.rm = TRUE)) #collapse across trials
boo1 <- subset(boo1, TIMECODE < 4001)
boo2 <- ddply(boo1,.(block,switch,TIMECODE),summarise,pupilavg=mean(pupil,na.rm = TRUE),sepupil=sd(pupil, na.rm = TRUE)/sqrt(length(pupil))) #collapse across subs
vlines <- c(250,1750,2550)

ggplot(boo2,aes(x=TIMECODE,y=pupilavg,color=factor(switch),fill=factor(switch)))+
  geom_line()+theme_bw()+
  theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"))+
  ggtitle("Timecourse: Pupil Change")+
  labs(x = "Time", y = "Pupil change from baseline (%)")+
  theme(plot.title = element_text(face="bold", size=20, hjust=0))+
  theme(axis.title = element_text(face="bold", size=20))+ 
  theme(axis.text.x  = element_text(size=20),axis.text.y  = element_text(size=20))+
  theme(legend.text=element_text(size=16),legend.title=element_text(size=16))+
  geom_ribbon(aes(ymin=pupilavg-sepupil,ymax=pupilavg+sepupil),alpha=0.4)+
  geom_vline(xintercept = vlines)+
  scale_x_continuous(limits=c(0,4000),breaks=seq(0,4000,500), expand = c(0, 0))+
  scale_fill_discrete(name="Switch",breaks=c("1", "2"),labels=c("Pre-Switch", "Post-Switch"))+guides(color=FALSE)+
  facet_wrap(~block,dir="v")+
  scale_y_continuous(labels=percent,limits=c(-0.2,.2),breaks=seq(-0.2,.2,.05), expand = c(0, 0))
```

eccentricity timecourse plot for orig.sample2
```{r}
# screen res is 1024 x 1280 (Y X)
#a. Y coordinate timecourse, pre and post
#line graph
boo <- subset(orig.sample2, TIMECODE < 4001)
boo$RIGHT_GAZE_X2 <- abs(boo$RIGHT_GAZE_X-640)

boo1 <- ddply(boo,.(subID,switch,TIMECODE),summarise,xcoordinate=mean(RIGHT_GAZE_X2,na.rm = TRUE)) #collapse across trials
boo2 <- ddply(boo1,.(switch,TIMECODE),summarise,Xavg=mean(xcoordinate,na.rm = TRUE),seX=sd(xcoordinate, na.rm = TRUE)/sqrt(length(xcoordinate))) #collapse across subs
vlines <- c(250,1750,2550)

ggplot(boo2,aes(x=TIMECODE,y=Xavg,color=factor(switch),fill=factor(switch)))+
  geom_line()+theme_bw()+
  theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"))+
  ggtitle("Timecourse: eccentricity")+
  labs(x = "Time", y = "absolute distance from center of screen")+
  theme(plot.title = element_text(face="bold", size=20, hjust=0))+
  theme(axis.title = element_text(face="bold", size=20))+ 
  theme(axis.text.x  = element_text(size=20),axis.text.y  = element_text(size=20))+
  theme(legend.text=element_text(size=16),legend.title=element_text(size=16))+
  geom_ribbon(aes(ymin=Xavg-seX,ymax=Xavg+seX),alpha=0.4)+
  geom_vline(xintercept = vlines)+
  scale_x_continuous(limits=c(0,4000),breaks=seq(0,4000,500), expand = c(0, 0))+
  scale_fill_discrete(name="Switch",breaks=c("1", "2"),labels=c("Pre-Switch", "Post-Switch"))+guides(color=FALSE)+
  scale_y_continuous(limits=c(0,400),breaks=seq(0,400,50), expand = c(0, 0))

#facet_Wrap by block
#line graph
boo1 <- ddply(boo,.(subID,block,switch,TIMECODE),summarise,xcoordinate=mean(RIGHT_GAZE_X2,na.rm = TRUE)) #collapse across trials
boo2 <- ddply(boo1,.(block,switch,TIMECODE),summarise,Xavg=mean(xcoordinate,na.rm = TRUE),seX=sd(xcoordinate, na.rm = TRUE)/sqrt(length(xcoordinate))) #collapse across subs
vlines <- c(250,1750,2550)

ggplot(boo2,aes(x=TIMECODE,y=Xavg,color=factor(switch),fill=factor(switch)))+
  geom_line()+theme_bw()+
  theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"))+
  ggtitle("Timecourse: eccentricity")+
  labs(x = "Time", y = "absolute distance from center of screen")+
  theme(plot.title = element_text(face="bold", size=20, hjust=0))+
  theme(axis.title = element_text(face="bold", size=20))+ 
  theme(axis.text.x  = element_text(size=20),axis.text.y  = element_text(size=20))+
  theme(legend.text=element_text(size=16),legend.title=element_text(size=16))+
  geom_ribbon(aes(ymin=Xavg-seX,ymax=Xavg+seX),alpha=0.4)+
  geom_vline(xintercept = vlines)+
  scale_x_continuous(limits=c(0,4000),breaks=seq(0,4000,500), expand = c(0, 0))+
  scale_fill_discrete(name="Switch",breaks=c("1", "2"),labels=c("Pre-Switch", "Post-Switch"))+guides(color=FALSE)+
  facet_wrap(~block,dir="v")+
  scale_y_continuous(limits=c(0,400),breaks=seq(0,400,50), expand = c(0, 0))

```


<<<<<<< HEAD

=======
<<<<<<< HEAD
<<<<<<< HEAD

=======
>>>>>>> e07315faf246ed4d60125eedc34ea193d6ecb04d
>>>>>>> 619613d5808cccb9dddffadafe69798ac9e89045
=======
>>>>>>> e07315faf246ed4d60125eedc34ea193d6ecb04d
>>>>>>> 619613d5808cccb9dddffadafe69798ac9e89045
